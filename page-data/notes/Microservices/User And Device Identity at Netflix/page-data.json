{"componentChunkName":"component---src-templates-note-template-js","path":"/notes/Microservices/User And Device Identity at Netflix/","webpackCompilationHash":"1307dca3626bbb061791","result":{"data":{"markdownRemark":{"html":"<p>Source: <a href=\"https://www.youtube.com/watch?v=eEZHZ806d6o\">https://www.youtube.com/watch?v=eEZHZ806d6o</a></p>\n<ul>\n<li><strong>User ReAuth errors</strong>: When users are logged out and fail to sign-in again due to misspelling or something similar. This may trigger an outage incident which might take longer to resolve even after the server side issues are resolved.</li>\n<li>Netflix tries to make sure no one is logged out of their devices due to changes on their servers</li>\n<li>ðŸ’¡ An issue in authentication would take long time to get resolved in production. It would span across multiple teams due to complicated architecture.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a4b70c9b06935484d18674c5ed1d0e4/5d6f6/Untitled.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.97951142631994%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABbElEQVQoz2VRy27bMBDk//9R7r0WAeocGjswklixk+pFUlpyuVxSGcloYbijAQVpZ/ZFkyY3vbzQTMycwIRjRYzx8WgdybJULStqKTnr0/Px56/f1noojT0dmx8PkyctVVWzqmRooK+itS734CQokVeoYdFpDiHyxoQYTgoMX5TAWa5+VIbnX4okGTIDHwjpDEeSa0xEaq2t74dpziyVOUee/SScrJtTZEwCmXF+BmeKo/XD6JIIitz2WSjI5ZOHISB7kD8dkkSMt5rRu3MTFqA5o2BRxWJQdtnmLSHK59dS1p35ibLmr7abZkIIGoMXEXVth09MtlL1Sk2izIWobFP0o3Oe6pb5ClMj89v728cFa7tbLNZethbqelF1dMSSbwUGN8OjPTUXogCR3qBsXO8E82RtWrIh4lf5C2OdG8exb9uh7YauG/veDsM9LVTOe7c+NzCH/WG32x027Pf7U9N8nM/3/B/n8+n19RsoenkyKggkGAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Netflix uses JIRA for prod tickets\"\n        title=\"\"\n        src=\"/static/0a4b70c9b06935484d18674c5ed1d0e4/34e8a/Untitled.png\"\n        srcset=\"/static/0a4b70c9b06935484d18674c5ed1d0e4/d4214/Untitled.png 150w,\n/static/0a4b70c9b06935484d18674c5ed1d0e4/135ae/Untitled.png 300w,\n/static/0a4b70c9b06935484d18674c5ed1d0e4/34e8a/Untitled.png 600w,\n/static/0a4b70c9b06935484d18674c5ed1d0e4/fea0e/Untitled.png 900w,\n/static/0a4b70c9b06935484d18674c5ed1d0e4/6ff5e/Untitled.png 1200w,\n/static/0a4b70c9b06935484d18674c5ed1d0e4/5d6f6/Untitled.png 1269w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Netflix uses JIRA for prod tickets</figcaption>\n  </figure></p>\n<ul>\n<li>This complications lead to change in their architecture</li>\n<li>The talk is not about service-to-service communication inside the Netflix ecosystem, it is more about authenticating Netflix subscribers and the devices they use</li>\n</ul>\n<h2>Old Netflix Architecture to authenticate Users</h2>\n<ul>\n<li>When a User enters his credentials for Netflix, the request lands on Netflix's EDGE proxy(Zuul)</li>\n<li>Zuul also allows to run custom filter code on requests</li>\n<li>Each device has an ESN(Electronic Serial Number) associated with it</li>\n<li>The ESN is passed along with the user credentials in the <code class=\"language-text\">/login</code> requests, which is routed to their origin server</li>\n<li>This then travels to one of their MidTier severs called AUTH server, which validates the credentials, and returns an HTTP cookie and device identity information along with it</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/16a5a5c95432c901af8f65b1f8b4a513/8d6e5/Untitled%201.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.193798449612395%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABdUlEQVQoz41RyW6DMBTk/7+pUlSplwQpaUA0oVnEEkJYHJbY4IVAx1BFqKfOwR4/v7HHY6Pve0ppMwLkOaIf8eLPGfoZjGEYTNN0HAfjYrFAafg3tHgSTKeCNKwBB6GUCSFAOOePx6N+1FP9r/jlE2Pbtl3XoQ6ilAKRUsZxXBQlCCFk8v8rpoydTmff9wPfv9/v2Og6JQRXqgOHHieijlBwaFVVk00txl0kiqLzGSZbLuuqzvOcNU0r9CWY0bTerD3fS5NUSAGfN1JQ1mgxXrnbfLqWzXkbHh1GqVSK0Tq7nKTq7uk1i07vX2/L3UccxXgINN9+WFT1r210KxhSMvP3sPzsB8GbNHARH6tImYZjLtonGm+32ytjY8rmtcYS2U45IWrOBWtaqsFQRwUvx66SssM/kzxPkiTLslQjQTCFBmaCbPa73Wq13G63tm1fr1dslGVZjBOJY+N4OFiW5e41XNf1PC+YQX9BEIQj5tXwcjmY5g9KpnHp1bZDegAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Netflix&#39;s Old Login Architecture\"\n        title=\"\"\n        src=\"/static/16a5a5c95432c901af8f65b1f8b4a513/34e8a/Untitled%201.png\"\n        srcset=\"/static/16a5a5c95432c901af8f65b1f8b4a513/d4214/Untitled%201.png 150w,\n/static/16a5a5c95432c901af8f65b1f8b4a513/135ae/Untitled%201.png 300w,\n/static/16a5a5c95432c901af8f65b1f8b4a513/34e8a/Untitled%201.png 600w,\n/static/16a5a5c95432c901af8f65b1f8b4a513/fea0e/Untitled%201.png 900w,\n/static/16a5a5c95432c901af8f65b1f8b4a513/6ff5e/Untitled%201.png 1200w,\n/static/16a5a5c95432c901af8f65b1f8b4a513/8d6e5/Untitled%201.png 1290w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Netflix&#39;s Old Login Architecture</figcaption>\n  </figure></p>\n<ul>\n<li>Once the user lands on home page of Netflix, it makes an API call to the edge proxy along with the acquired Cookie</li>\n<li>\n<p>The API server decrypts this cookie using an external cryptographic key which is provisioned by a key management service built by Netflix</p>\n<ul>\n<li>Key Management service provides storage and control for cryptographic keys</li>\n</ul>\n</li>\n<li>\n<p>Server takes the cookie, cuts it open using the cryptographic key and if the cookie is valid and has not expired, it will send the customer ID and ESN information downstream</p>\n<ul>\n<li>The server would also renew the cookie if it was expired</li>\n</ul>\n</li>\n<li>This will help in generating the personalized homepage for that customer ID</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0af0d854d8aa1673282b1ad0319ec073/1002f/Untitled%202.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.317411402157155%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVQoz42Rz07CQBDG+whqwk0OXj148AH04MGTd99Fb4QX0pMHSCokQL0UWlSIFJqSKm13u9uubEv/4LQFhMQQf0l3p9mZ2W++FeI4jqJosQX8JkkS5cR7EdI0VVW10Wg0m81OpyNJL6IotlotSZLSJF3uRYAvDEMeBAHnfM5dl2T7fO75PgRwulEBwR/FG4o8CGASXWljBxOXwCCGYSiKAh0hASPMfBZHMUjOimGDdTqUif0Jgam9WsYH59/tbhO5DnIQxthxHBAIjSzL8jwvzclmZoR4LmE+9ShhjFEX+R6ljIr9py/btC07a4AQ1MNwUDmbzQIe5MXLpVSr1x4eTQtugBZssXI7TmPQ/+tt8RZjbSzLXXAH7BRgyKuLy8Oj0nH5pFqpgmzISNbAabpL4c5K9iLgtzfX52en5dJB5f6uMB/uCXMKkwuKy6M12TtjhN5U9b0vS8/1fq9HPRicUApLBt2FbIOxoI1Gg+FA0ybG1BxPJrquG/9D6/Z+AC76XmL8kGPhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Authentication Request\"\n        title=\"\"\n        src=\"/static/0af0d854d8aa1673282b1ad0319ec073/34e8a/Untitled%202.png\"\n        srcset=\"/static/0af0d854d8aa1673282b1ad0319ec073/d4214/Untitled%202.png 150w,\n/static/0af0d854d8aa1673282b1ad0319ec073/135ae/Untitled%202.png 300w,\n/static/0af0d854d8aa1673282b1ad0319ec073/34e8a/Untitled%202.png 600w,\n/static/0af0d854d8aa1673282b1ad0319ec073/fea0e/Untitled%202.png 900w,\n/static/0af0d854d8aa1673282b1ad0319ec073/6ff5e/Untitled%202.png 1200w,\n/static/0af0d854d8aa1673282b1ad0319ec073/1002f/Untitled%202.png 1298w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Authentication Request</figcaption>\n  </figure></p>\n<h3>Issues with this Architecture</h3>\n<ul>\n<li>Each block here represents a cluster of AWS EC2 instances</li>\n<li>API servers form primary API service which hold functionalities for different API endpoints</li>\n<li>Legacy API server is used by older devices</li>\n<li>There were various individual blocks that needed cookies. This meant it was a security concern</li>\n<li>A lot of origin and mid tier services needed cookies and not having a central service for identity resolution caused discrepancies and a lot of errors</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/844a33bbace735289b43baeb8214a8e5/3399b/Untitled%203.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.79432079815809%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACF0lEQVQozzWSWW/TQBSF+795Q4iXSkClUkFBpbxQpRUKTaW0aZqlakRiUokssrM4jhMv2ezxjMeOPR5vjNNwXubM1f10l5mDOI4xxgEhzDgutrGdpmmSJAhDYAEWDMPQtm3TNF3XjXaKo70OWKogDG2MmeHmj3Wh0KqU622hquQvnj/bDkrihBDi+z6lNCPj2CMBpSHLz2ADd4HBqyp6Uit/Ng/cU7svDK7F8+9/P7i+kyYpI7dbj7UThVESx72xBJG9h7k1aHW4L+9Orp4vW8t7FqERrcj54uTC3eIkjF4KpjtFYYgRCoLgBU6+TdLKYks26zv+uqnejaZgtjS4+UOx+xMYer50dF4/mWgjRZdXumwB4CKXDbKvfNYEjYnDTE28rYwK2cLS+Lj09vDmFSYwx52e1g5z7a8fb18XykdTWSZkQam/h7uz3mQhBZg2lPvq8FLjO8PZoiGVy/wv7Noe8Sxo6kvNhIZLtr7nG6tHz4N7uMMN1dkiG16v1cQrbdQVJKU4zP1ofWLbZktmTWLs0IAGJGDjG2BFiLuHJ4qqrdbMNNRSVb7JtpKGZ7/fH9ffIMfytn72zoaJEPJ9jxDanHWwayUMRhCOZEWcKxDAwaw/mPehBTeGMdC6vNYxgcmuFvsuJgDAYoIQ2thByIYAHEiSJPC8OB6PxbEkTnV1oe601NYrfc2Moijqfyk7Zcd8LnV7/wAj5U1kG6/N/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"High Level Diagram of part of a Netflix ecosystem\"\n        title=\"\"\n        src=\"/static/844a33bbace735289b43baeb8214a8e5/34e8a/Untitled%203.png\"\n        srcset=\"/static/844a33bbace735289b43baeb8214a8e5/d4214/Untitled%203.png 150w,\n/static/844a33bbace735289b43baeb8214a8e5/135ae/Untitled%203.png 300w,\n/static/844a33bbace735289b43baeb8214a8e5/34e8a/Untitled%203.png 600w,\n/static/844a33bbace735289b43baeb8214a8e5/fea0e/Untitled%203.png 900w,\n/static/844a33bbace735289b43baeb8214a8e5/6ff5e/Untitled%203.png 1200w,\n/static/844a33bbace735289b43baeb8214a8e5/3399b/Untitled%203.png 1303w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">High Level Diagram of part of a Netflix ecosystem</figcaption>\n  </figure></p>\n<ul>\n<li>\n<p>Netflix Stats</p>\n<ul>\n<li>Netflix has more than 158 Million subscribers</li>\n<li>Netflix App is on more than a Billion devices</li>\n<li>The edge layer has 2 Million peak requests per second</li>\n</ul>\n</li>\n<li>If there were multiple places where cookie was getting decrypted, it only increased the CPU load</li>\n<li>\n<p>One other major issue was there were multiple token types</p>\n<ul>\n<li>Auth tokens for Signup, Login, Discovery [Cookie]</li>\n<li>MSL(Message Security Layer) tokens for Device authentication and Encryption [Blue Dragon Head]</li>\n<li>CTicket tokens for legacy device [RGY tickets]</li>\n<li>Partner tokens for partners [WPB Spiral]</li>\n</ul>\n</li>\n<li>This all meant redundant CPU cost</li>\n</ul>\n<h3>New Architecture</h3>\n<ul>\n<li>Moved all the decryption to edge layer and then send the decrypted data downstream</li>\n<li>New microservices were handled life cycles of cookies</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1079dc33ba9c8a62618d3da7738e291f/4a1e0/Untitled%204.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.19266055045872%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1UlEQVQoz4WSS2/TQBDH8535CuQAl0pIgKpICPXEpRIHBBVFDUi0NDEtTUyIWzdOTZMmfuzL3vU+/FimqYPEidHuaHY9v5n/7rpjrVVKVlUFAXgueNM0EBeykEpCAMuc54QSpZT91zowvekVpQyCaXzxZvIyxL6tLctYnudQrixLrTUUMsbAsq5rqTRstnDExghN44h/X3/rTbpePGqMhW6c86IoIF9KKQoBEoAB2PWDLOctfJGkZ+6wt/N8f/C2d969jF3onCRxkiRG6+rBNlhT3/OEYNDSwq9n9mAh2DLsex93zzZwZTFBhBBIAvGUUpCQpilogZjTXP2F9xz2YRxbLb8Gh0+OHjn+sVFmsVxEUQx9GGUYY6MNShEUCoKZUmtjtvDPW3cWBbax1+vpO3c/jOamMHfruziKtdIACy6yLMMIg5eyiFd9JVkLu87V75vV5eTT/NZ3/JvT88HB0SFlBFLhhimjoFYIgTAC8WVZYbzSWrTwLFx64fWLfvfVl53dz09hPHv/OOcZYHBmOGTGMhgIIUapLqvTcCRltoGbJsn4kuAfnjMYHQ/HJ0P35Nd8rI2G1yq3Vm3t4Re693XdgdoEY8FzuCQp1ObT/62pKp2kfwBbO2L6hDilsgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"EAS(Edge Authentication Layer) introduction\"\n        title=\"\"\n        src=\"/static/1079dc33ba9c8a62618d3da7738e291f/34e8a/Untitled%204.png\"\n        srcset=\"/static/1079dc33ba9c8a62618d3da7738e291f/d4214/Untitled%204.png 150w,\n/static/1079dc33ba9c8a62618d3da7738e291f/135ae/Untitled%204.png 300w,\n/static/1079dc33ba9c8a62618d3da7738e291f/34e8a/Untitled%204.png 600w,\n/static/1079dc33ba9c8a62618d3da7738e291f/fea0e/Untitled%204.png 900w,\n/static/1079dc33ba9c8a62618d3da7738e291f/6ff5e/Untitled%204.png 1200w,\n/static/1079dc33ba9c8a62618d3da7738e291f/4a1e0/Untitled%204.png 1308w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">EAS(Edge Authentication Layer) introduction</figcaption>\n  </figure></p>\n<ul>\n<li>The EAS was built in such a way that it could handle 95% the tokens without making any remote calls</li>\n<li>\n<p>For the remaining 5% either the token needs to be renewed or some sort of device auth</p>\n<ul>\n<li>This made Zuul(Edge Layer) were resiliant which was very important because if Zuul is down, Netflix is down</li>\n</ul>\n</li>\n<li><strong>Fall Back system if cookie service fails</strong></li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/57039c0c6a4aa3a4461d436138aef5c7/3e986/Untitled%205.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.828220858895705%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABfklEQVQoz4WRXUvDMBSG++MFL0RvBBFBRPBCcVei4gciMj+2OWVu1bF2naurm7NJkyZt125L6knBsenQBxKSk/Mmec/RxlNwzkajkRBCbaSEiTISxREsIA5jPIuWZkgpYdZr9TiOhVTqdCjYwNt7Wb+yj1VCKtNfaN8Lddb17pLE58GgWblNnB7m/e368rmdC3mEMfI8D66eK1byfMfpeDTiQceq+5R1cWejtHjU2GWUI4QwwpRQMDVHDE+vvEiDqS+IzAUd4K3K0lkr9++3FSuX+PnN7zn2a7v17ry3uuZaaWG/vDkpyl/iglkinEBRzUo+CgPK8Elxp/x6I0U6ThIRx9CA+WLQPFw/U8zUO5mxBEzeFngQ8iAYEjLsuyIMZ8Rgb4JuWJhQ0Ko2CxmP4q386kX1EPLGWaEgWUyQUoMGuMCni1y3ZlrOR58xnxBCqe9R7/T+4NEoBjzIIjMQhDTLsnRdbzQapmE2TcO27bcp3D7qdT9+BAG73baeql90KGpT602QWQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Netflix&#39;s fall back to cookie service failure\"\n        title=\"\"\n        src=\"/static/57039c0c6a4aa3a4461d436138aef5c7/34e8a/Untitled%205.png\"\n        srcset=\"/static/57039c0c6a4aa3a4461d436138aef5c7/d4214/Untitled%205.png 150w,\n/static/57039c0c6a4aa3a4461d436138aef5c7/135ae/Untitled%205.png 300w,\n/static/57039c0c6a4aa3a4461d436138aef5c7/34e8a/Untitled%205.png 600w,\n/static/57039c0c6a4aa3a4461d436138aef5c7/fea0e/Untitled%205.png 900w,\n/static/57039c0c6a4aa3a4461d436138aef5c7/6ff5e/Untitled%205.png 1200w,\n/static/57039c0c6a4aa3a4461d436138aef5c7/3e986/Untitled%205.png 1304w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Netflix&#39;s fall back to cookie service failure</figcaption>\n  </figure></p>\n<ul>\n<li>If the cookie service is down, the edge layer will resolve identity and send back a <code class=\"language-text\">*RESCHEDULED*</code> cookie</li>\n<li>This is a very short lived cookie and will expire soon</li>\n<li>On the next API call hopefully the server issues are resolved</li>\n<li>The logical question: How to resolve identity?</li>\n<li>New Identity Structure: Passport</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1ca32e3425650bf1a8e2a2b32ca3a38e/8ec6f/Untitled%206.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.12557427258806%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/klEQVQoz1WQR2/bQBCF9bNzDHJRcohOKQcbhn9AEh8cBHEQKQWKXCQLosWIoljMXsUld5dlKVJkRsWHPBCDwYLfzLzXqeuappSxYlNVBWOYJGmWEUrTNCWElJud4jgOwxBeqv/Vadt2KUhJQqARgtlH6fRWHP1dyHVdmbY9mT00TVOWJWMMpmz3graqavh/B/sJhyJhHeYT7/pcfDUSf61W+nZbub7P8Yu2aYqiyLIMpsA2gHn5MSH0CM/C9T0/Pum9/XBzccZ1J+q150SEYE03RFkBBqwdsGbb1FUdIwS3HODmTGm/mCm29IFwdcp1YbMsaZCCbphTbp7nOXiGul6vwXaSJDSGjI5we36HP3NBW5VD9Xtv+Oxy9GnK8XEcOY6T5TnGOIoi2HyAZVlmzNts2BHmzbnsK23Tyt7iq3DBK3PbCkxLF4Qlv1imlKI4Ht7eIYRgEPj33UGRJ0d4PhYNzV0tBpopjyVtwt0Phj+DwDMMS9UMshMNwsj3fUppVW8R8kqWHmFJNQR19ab/4uTH6/eDl+8G3d7lc0wwoRiSgpvBM05w4AcoQgXbjNQpzeIdDJeolivq+u9xv//nqj/6Bt8NNwzDwHbsCKHoSWjfQ2CYQGw4ieOOqig8PxfFpSI/SqJkGZZjua7tmqZpWzZU09qXJ5l7Gbqmcg//AMbZURcPKHrSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Updated Flow with Passport\"\n        title=\"\"\n        src=\"/static/1ca32e3425650bf1a8e2a2b32ca3a38e/34e8a/Untitled%206.png\"\n        srcset=\"/static/1ca32e3425650bf1a8e2a2b32ca3a38e/d4214/Untitled%206.png 150w,\n/static/1ca32e3425650bf1a8e2a2b32ca3a38e/135ae/Untitled%206.png 300w,\n/static/1ca32e3425650bf1a8e2a2b32ca3a38e/34e8a/Untitled%206.png 600w,\n/static/1ca32e3425650bf1a8e2a2b32ca3a38e/fea0e/Untitled%206.png 900w,\n/static/1ca32e3425650bf1a8e2a2b32ca3a38e/6ff5e/Untitled%206.png 1200w,\n/static/1ca32e3425650bf1a8e2a2b32ca3a38e/8ec6f/Untitled%206.png 1306w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Updated Flow with Passport</figcaption>\n  </figure></p>\n<ul>\n<li>\n<p>Passport:</p>\n<ul>\n<li>Identity structure created at edge for each request</li>\n<li>contains user and device information</li>\n<li>internal to Netflix ecosystem</li>\n<li>integrity protected by <strong>HMAC</strong></li>\n<li><strong>Protobuf</strong> format</li>\n</ul>\n</li>\n<li><strong>Updated Login Flow</strong></li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ec3b3e02e0fb1b83f0cd6329fd18a5cc/9e01d/Untitled%207.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.14973262032086%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABfklEQVQoz3VSXW+CQBD0J/c39O/0oW9N2idNbTVUxUQMWjDVWqgJoHB3HHdwBx0+YlPb7gMctzOzu7P0tNaUUs55mqaMsfbchhACz7Isq3+il+e5YRiDwcA0zbk5Hw6H0+nUnJnL5XLUBNTBB6woiguh3m+9LMuklFopdIHiuBFSxKeYEKKUAr+V68jAIUcZJZSgQlWVhNKn0RiITkjr/X4fx7EU8nA41BStOzL62W13nuf5nheGYTNqNjHnSFn22rJXVVlxVqsAiWxbvCN/HBP7MxBS8kwwyoIg4CnHPUqRhGLY+8e7mfXiez7IqlALd0sY68jQPLEUoPWknzKKaRJ6WtjPSL2925ut5Ya2e7ApYSiLjUTRUcr80rBCcJFSHLAhY1KTX52V467PQ6Iy+voxcxsYpC61Gk/s/sZ3HMdVWsEIWIX71ufW5G+38VJNQBXG+Mn79c3Vw+K2BjVyF7vtPhvTermUURRhS2kTQmaJPPKcnTF//mFlUcgw+gL6p3MKMbuNuQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"New Login Flow at Netflix\"\n        title=\"\"\n        src=\"/static/ec3b3e02e0fb1b83f0cd6329fd18a5cc/34e8a/Untitled%207.png\"\n        srcset=\"/static/ec3b3e02e0fb1b83f0cd6329fd18a5cc/d4214/Untitled%207.png 150w,\n/static/ec3b3e02e0fb1b83f0cd6329fd18a5cc/135ae/Untitled%207.png 300w,\n/static/ec3b3e02e0fb1b83f0cd6329fd18a5cc/34e8a/Untitled%207.png 600w,\n/static/ec3b3e02e0fb1b83f0cd6329fd18a5cc/fea0e/Untitled%207.png 900w,\n/static/ec3b3e02e0fb1b83f0cd6329fd18a5cc/6ff5e/Untitled%207.png 1200w,\n/static/ec3b3e02e0fb1b83f0cd6329fd18a5cc/9e01d/Untitled%207.png 1309w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">New Login Flow at Netflix</figcaption>\n  </figure></p>","frontmatter":{"date":"July 29, 2020","title":"User & Device Identity for Microservices @ Netflix Scale"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/notes/Microservices/User And Device Identity at Netflix/"}}}