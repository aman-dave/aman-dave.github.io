{"componentChunkName":"component---src-templates-note-template-js","path":"/notes/Microservices/Mastering Chaos A Netflix Guide to Microservices 747174a6cb614f57b707496a748df0bf/","webpackCompilationHash":"1307dca3626bbb061791","result":{"data":{"markdownRemark":{"html":"<h1>Mastering Chaos - A Netflix Guide to Microservices</h1>\n<p>Source: <a href=\"https://www.youtube.com/watch?v=CZ3wIuvmHeM\">https://www.youtube.com/watch?v=CZ3wIuvmHeM</a></p>\n<ul>\n<li>86 million members, ~190 countries, 10 languages and 1000s of devices</li>\n<li>Microservices on AWS</li>\n</ul>\n<h2>Netflix DVD Data Center - 2000</h2>\n<ul>\n<li>\n<p>Monolithic Code Base</p>\n<ul>\n<li>Everyone was pushing into one codebase</li>\n<li>If there were any issues, it took atleast a week to diagnose them</li>\n</ul>\n</li>\n<li>\n<p>Monolithic Database</p>\n<ul>\n<li>A single large database</li>\n<li>During holiday season, the rush was immense and hence they had to rush to vertically scale and buy more hardware</li>\n</ul>\n</li>\n<li>\n<p>Tightly Coupled Architecture</p>\n<ul>\n<li>Even adding a column to a database was a mini project in itself</li>\n</ul>\n</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e49dcf28dbc46943b52eca8f6fe357d0/83ac2/Untitled.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.63650075414781%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4klEQVQoz2OQlJRUVVOTlZOTlpaRlZeTlpGRlZOVlpGWkpaWlJKSlpXh4+Pj4eVFQ1zc3BISkgwCAgL6BgbaOjpq6mq6erp6enpAtpaWlo6ujrqGuqaWJjMzMwMDAyMMMMAA0FAGXl5eIIsZDNjY2ZiYmRhQAVCchYWFgRHBhRjHz88P1Qw0xtPLU0hYyNjEOCIqMiAwMCAo0M7eDijFysoKJIGykyZNam1rVVVVhZiC0MzNw71mzRphYeHK6sqLly+dOHXy5OmTh44csrK2EhUXU1BQOH78+H8wyM7JAapnYmJCaObh4Vm0eJGEpERMXOz5SxcOHj20eduWE6dOrFqzSlRUhJ2Do76h/vKVy6dOn3J0dETYLCIqArRWWlp63vy5RsZGMrKyi5YsOnXm9OGjh4Hk3PnzgIHEzALyJw83D9BCIBcUBBDN4uLiwAAXFBKcOXuWuoYGUB3QFVJSUmLi4kATRUVFISHs6+c7bfq0puZmZRVlDD9zc69ctRIY5wKCAkBpSSlJIIJGDJjYvXs3xM+5ubkIPwPtAXK4uLgmTJwgJiYmKCSkpKKspKykoKgADD+gCyFGlJWXHz12dO++vba2doh4hmgGxgc7BzuQBPqNCQZYkQDENpD/IdEO1gwACsB1fIQ37m0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Netflix Data Center circa 2000\"\n        title=\"\"\n        src=\"/static/e49dcf28dbc46943b52eca8f6fe357d0/34e8a/Untitled.png\"\n        srcset=\"/static/e49dcf28dbc46943b52eca8f6fe357d0/d4214/Untitled.png 150w,\n/static/e49dcf28dbc46943b52eca8f6fe357d0/135ae/Untitled.png 300w,\n/static/e49dcf28dbc46943b52eca8f6fe357d0/34e8a/Untitled.png 600w,\n/static/e49dcf28dbc46943b52eca8f6fe357d0/fea0e/Untitled.png 900w,\n/static/e49dcf28dbc46943b52eca8f6fe357d0/6ff5e/Untitled.png 1200w,\n/static/e49dcf28dbc46943b52eca8f6fe357d0/83ac2/Untitled.png 1326w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Netflix Data Center circa 2000</figcaption>\n  </figure></p>\n<h2>What is a microservice?</h2>\n<blockquote>\n<p>... the microservice architectural style is an approach to developing a single application as an suite of small services, each running on its own process and communicating with lightweight mechanisms, often an HTTP resource API\n— Martin Flower</p>\n</blockquote>\n<ul>\n<li>\n<p>Separation of concerns</p>\n<ul>\n<li>Modularity, encapsulation</li>\n</ul>\n</li>\n<li>\n<p>Scalability</p>\n<ul>\n<li>Horizontal Scalling</li>\n<li>Workload partitioning</li>\n</ul>\n</li>\n<li>\n<p>Virtualization and Elasticity</p>\n<ul>\n<li>Automated operations</li>\n<li>On demand provisioning</li>\n</ul>\n</li>\n</ul>\n<p>⇒ You can think of microservices as organs of human body, that are responsible for individual functions</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/525ae28944d7a1ad2d59d5f1d954bbd8/1d86b/Untitled%201.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.3114134542706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB60lEQVQoz2WR+3PSQBDHSS4Jd3lJk/DIER55AAUsAUtK0NFpY8EZrQWn1uoPfViFFi0dR0edMlR/9bfq6B/sRTp92Ju9nd2b/ex37y6CMa5Uq3nTNDLpXD6XzWbJSSabTRuG7TimZVq2ZWQyvCCIknRhJE3peiQWi5Ur5Xqj7t9t++22t+SRXovNJvEt328ueYueV3NdhFDk+pIkKSLLMokSyUSlOu8uVEoFCyc1PbR4Kq7qCe2fqbaZE6IcB+iQo0IXgjN4TlHcxu3u6sr62mPig5UH3U7wqBusPlwmcacTEIMsK/KQnvFXYUVV6o2a1/K2Xr0cjg7ejY+Gh8Pxh+P9t29G70dHx+PBwQAAgFAUXIXD0ckgFCWKPC/wiqY5pRJ5IUmWGYZhWdZxHIx1wABSxguIpm/CEYphwWBn+8f3b6efPhoYH+7tIggJLYgCaRpT5ogyEaBvKpMFEZeMa8WCc6fuFosF2zL9tj+ZTqan089fv5BZTiYnppWbjfk/jHh4cR8IoaKqLb/Vf9bf2Hy++3oPp3Gv30vpiWuvLYriOYyiLANo6vwbZ+1tx37ydG1z68V8ubxQq+XNS+VQlewwoShZ5DO3JIyQxHGQZUQYJRUbvfXfP8/+/DrrBMv7O9v37/nkEABmpvwXNvNNEA+NAKcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Thinking of Microservice in terms of abstraction\"\n        title=\"\"\n        src=\"/static/525ae28944d7a1ad2d59d5f1d954bbd8/34e8a/Untitled%201.png\"\n        srcset=\"/static/525ae28944d7a1ad2d59d5f1d954bbd8/d4214/Untitled%201.png 150w,\n/static/525ae28944d7a1ad2d59d5f1d954bbd8/135ae/Untitled%201.png 300w,\n/static/525ae28944d7a1ad2d59d5f1d954bbd8/34e8a/Untitled%201.png 600w,\n/static/525ae28944d7a1ad2d59d5f1d954bbd8/fea0e/Untitled%201.png 900w,\n/static/525ae28944d7a1ad2d59d5f1d954bbd8/6ff5e/Untitled%201.png 1200w,\n/static/525ae28944d7a1ad2d59d5f1d954bbd8/1d86b/Untitled%201.png 1323w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Thinking of Microservice in terms of abstraction</figcaption>\n  </figure></p>\n<ul>\n<li>Every service(S) will have some data to work with, which will be stored inside a database(DB).</li>\n<li>A service client will use individual service to perform some action.</li>\n<li>A client library will first hit the cache to see if there is something available, if not it will call service client, which will return something as well as store it in cache</li>\n</ul>\n<h2>Challenges and Solutions of a Microservice</h2>\n<ol>\n<li>Dependency</li>\n<li>Scale</li>\n<li>Variance</li>\n<li>Change</li>\n</ol>\n<h3>1. Dependency</h3>\n<ul>\n<li>\n<p><strong>Intra-service requests</strong>: service A calling service B, maybe to fulfill a bigger request</p>\n<ul>\n<li>\n<p>It can lead to <em>network latency, congestion, failure, logical or scaling failure</em></p>\n</li>\n<li>\n<p>In a worse case, it can lead to a <strong>Cascading Failure,</strong> and by mistake you have deployed it to multi-region server — you are doomed!</p>\n</li>\n<li>\n<p><strong>Solution: Hystrix</strong></p>\n<ul>\n<li>Structured way of handling timeouts and retries</li>\n<li>Concept of fallback</li>\n<li>Isolated thread pools and concept of circuits</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/deb435e8291ec7e6bdfa408ee09f7741/b1dd5/Untitled%202.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.50529500756429%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACO0lEQVQoz32RS08TURTHb0IILgiy5bO40WhbTPgo6t4vYDChYVHjxp3lEVhoFHEjRqAt2AgttJ3Oo2Uo0xlm7tyZO+97p9N5OLhwp7+cc3Jyck7y/+eAV6urlTeV6ubG7u7O1vbW/tf9Zy+ez87OLi4uLvyL+wvz8/NLS0tgb//L1vYmP+AhgrIiT5O4XC4DAGZmZsB/uTc3B6ob1Vr9+Lh2dHJyUm/UWxcX6+uvHz18sPx0ubRcKpbyKBZKhSeFx8VC8S+FYmFlZQUgbDt+hB2i6Zokj69GrPBrDYk72R/SNM0roaQvXA8VPs3iOImjZJIPsW0BWz002bLKlzX9goTpGHYl5h26/oQsTVLGPnHFUe4IYWnvhqtAU5JV6UZl8mPDNAC6PZeYqjr86DiaT0PXd4XGS/FsTVJ7oshhz2j3jmzbtdSfmvgtCH0FQsPB3tTTDR1QSuI0S9IsjeM4itwAc533inAUBUHq4MjyUsfPsmQahmHgZfE0QTBwDY0qKlIBoQENiRPYxDdD6tgEd7lTWRQV7Zb4EA8+aEotyTLb16E1ytUqai8gFvbkO9le4BFCTM/UA6gHuu6qjfPPrc7p9fgGI/Gq9VYa/qCTmIaU5jkJfepNppMwinQDAahDZCCIdCgPLU3JnQhcZ9i9HEkjw7YMl5quix3Tsi3LuQvHdfPl/C+DqyHo9rrCgO9zXLN92Olf5g0n8KzAcTzX7rfOmGaTabb7bZZlGZZh2D7LsWet84PvB7VG/TdPCeh/CgVsTgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Netflix&#39;s use of Hystrix\"\n        title=\"\"\n        src=\"/static/deb435e8291ec7e6bdfa408ee09f7741/34e8a/Untitled%202.png\"\n        srcset=\"/static/deb435e8291ec7e6bdfa408ee09f7741/d4214/Untitled%202.png 150w,\n/static/deb435e8291ec7e6bdfa408ee09f7741/135ae/Untitled%202.png 300w,\n/static/deb435e8291ec7e6bdfa408ee09f7741/34e8a/Untitled%202.png 600w,\n/static/deb435e8291ec7e6bdfa408ee09f7741/fea0e/Untitled%202.png 900w,\n/static/deb435e8291ec7e6bdfa408ee09f7741/6ff5e/Untitled%202.png 1200w,\n/static/deb435e8291ec7e6bdfa408ee09f7741/b1dd5/Untitled%202.png 1322w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Netflix&#39;s use of Hystrix</figcaption>\n  </figure></p>\n<p>⇒ <strong><em>Fault injection Testing(FIT)</em></strong>: To inject faults intentionally to check how will the application react when its actually down</p>\n</li>\n<li>\n<p><strong>Critical Microservices</strong>: Services that are actually important and critical for applications</p>\n<ul>\n<li>FIT strategies were made so as to turn down all services except Critical microservices and see how it reacts</li>\n</ul>\n</li>\n<li>\n<p>CAP Theorem: Netflix chose <em>eventually consistency</em> using Cassandra</p>\n<ul>\n<li>Client writes to one node and then that node writes it to every other node</li>\n<li><em>Local Quorum</em>: X number of nodes need to respond back that they have committed the new changes</li>\n</ul>\n</li>\n<li>\n<p>Infrastructure: At some point, the infrastructure is going to fail</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3>2. Scale</h3>\n<ul>\n<li>\n<p><strong>Stateless service</strong>: not a cache or DB, frequently accessed metadata, no instance affinity and loss node is a non-event</p>\n<ul>\n<li>\n<p>Auto-scaling using AWS</p>\n<ul>\n<li>Compute efficiency</li>\n<li>Node failure</li>\n<li>Traffic Spikes</li>\n<li>Performance Bugs</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>Stateful service</strong>: caches and DB, custom apps hold large amounts of data, loss of node is a notable event</li>\n<li>\n<p><strong>EVCache</strong>: It is basically a wrapper around memcache, which writes multiple copies in multiple nodes in multiple locations</p>\n<ul>\n<li>It gives back response in milliseconds</li>\n</ul>\n</li>\n</ul>\n<h3>3. Variance</h3>\n<ul>\n<li>\n<p>Netflix uses Continuous Learning and Automation</p>\n<ul>\n<li>Incident ⇒ Resolution ⇒ Review ⇒ Remediation ⇒ Analysis ⇒ Best Practice ⇒ Automation ⇒ Adoption</li>\n</ul>\n</li>\n</ul>\n<h3>4. Change</h3>\n<ul>\n<li>Solutions first, teams second</li>\n<li>Reconfigure teams to best support your architecture</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/de7917e3f6342da8d0d1bedbdd293405/811c3/Screenshot_from_2020-07-14_19-07-07.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.36774679728711%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACIUlEQVQoz11STW8SURR98wVMZxiYgQFkOh8mA9URXFPTaQcTFyTUrS0sRE3VooBaGaK20RqJrtTEpqYxTbX+AnRbk7Yr7a5x1fhj8IwTE+PNzct7L++cc++5j2iaZhfsqTNThWLBtu1C0TYtyzRNWZZFUYwjRDEpJ/NaPncql8lm4lI8FotJCUnXdZJIJKzTVrFYzGuaaZnl82XnnIPkeZ4QQlEUVpZjgQGXIAr1+XqtVsM9GAkEPc9zZ93qxarrugzDkH+C+hMsy9I0jSOUjn8en/w6UVUV4mSx2dj7tjf6Ojo4PNg/3FczKh6hMAA4jqOZAANGwzQAwOXSrZvtu22KppSUQhYbjddv36yurQ5fDrd3tvEoGo2iQ7Q3qU+m0ilBEIDvD/wrCwsUTW+83/x+9GPWm4uhr0azOXw1bHfu9Af9rQ9buqGjTpTHT/B/lSmGpiU+hsTBNo1LVc+2TCWZDMDPXjy/vnRj8GgAMJyGPbA6raY1XYMrYGFYZnn59uX5ujDBrzy4v77+1DQNSZLI1Vbr3eYGkE/WHu9+3s3msoQiKDgwE6I0BSQ2lemKU3KwaV1r7Xz6WLkwDVIy53n+wO/0Or17vZX+w4CPEMMyzjqOGBdDz2EYegkNn3FnRl9GmFYwS/wC8l9QBJ6XyqVQPJgzy4YDw77b7Y7HY9/3g4pCKToMJkjoKIqCDwRulI3rCCIa4SJcmLIiY02l078B2C5sBqndfmEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Netflix: Mobile Architechture\"\n        title=\"\"\n        src=\"/static/de7917e3f6342da8d0d1bedbdd293405/34e8a/Screenshot_from_2020-07-14_19-07-07.png\"\n        srcset=\"/static/de7917e3f6342da8d0d1bedbdd293405/d4214/Screenshot_from_2020-07-14_19-07-07.png 150w,\n/static/de7917e3f6342da8d0d1bedbdd293405/135ae/Screenshot_from_2020-07-14_19-07-07.png 300w,\n/static/de7917e3f6342da8d0d1bedbdd293405/34e8a/Screenshot_from_2020-07-14_19-07-07.png 600w,\n/static/de7917e3f6342da8d0d1bedbdd293405/fea0e/Screenshot_from_2020-07-14_19-07-07.png 900w,\n/static/de7917e3f6342da8d0d1bedbdd293405/6ff5e/Screenshot_from_2020-07-14_19-07-07.png 1200w,\n/static/de7917e3f6342da8d0d1bedbdd293405/811c3/Screenshot_from_2020-07-14_19-07-07.png 1327w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Netflix: Mobile Architechture</figcaption>\n  </figure></p>\n<p>⇒ Netflix's mobile application architecture</p>\n<h2>Recap</h2>\n<ol>\n<li>\n<p>Dependency</p>\n<ol>\n<li>Apply circuit breakers, fallbacks and chaos</li>\n<li>Eventual Consistency</li>\n<li>Multi-region fail over strategy</li>\n</ol>\n</li>\n<li>\n<p>Scale</p>\n<ol>\n<li>Embrace Auto-scaling</li>\n<li>Reduce single point of failures</li>\n<li>Partition workloads</li>\n<li>Failure Driven Design</li>\n<li>Chaos under load</li>\n</ol>\n</li>\n<li>\n<p>Variance</p>\n<ol>\n<li>Engineered Operations and Automations</li>\n<li>Understand cost</li>\n<li>Prioritized support by impact</li>\n</ol>\n</li>\n<li>\n<p>Change</p>\n<ol>\n<li>Automated delivery</li>\n<li>Integrated practices</li>\n</ol>\n</li>\n</ol>","frontmatter":{"date":"June 20, 2020","title":"Mastering Chaos - A Netflix Guide to Microservices"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/notes/Microservices/Mastering Chaos A Netflix Guide to Microservices 747174a6cb614f57b707496a748df0bf/"}}}